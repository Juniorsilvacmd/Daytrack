version: "3.7"

services:
  daytrack_web:
    image: python:3.11-slim
    networks:
      - nioNet
    deploy:
      mode: replicated
      replicas: 1
      placement:
        constraints:
          - node.role == manager
      resources:
        limits:
          cpus: "1"
          memory: 1024M
        reservations:
          cpus: "0.5"
          memory: 512M
      labels:
        - traefik.enable=true
        - traefik.http.routers.daytrack-web.rule=Host(`daytrack.niochat.com.br`)
        - traefik.http.routers.daytrack-web.entrypoints=websecure
        - traefik.http.routers.daytrack-web.tls.certresolver=letsencryptresolver
        - traefik.http.routers.daytrack-web.service=daytrack-web
        - traefik.http.services.daytrack-web.loadbalancer.server.port=8000
        - traefik.http.services.daytrack-web.loadbalancer.passHostHeader=true
        - traefik.http.services.daytrack-web.loadbalancer.healthcheck.path=/
        - traefik.http.services.daytrack-web.loadbalancer.healthcheck.timeout=5s
    environment:
      - DEBUG=False
      - SECRET_KEY=django-insecure-production-key-change-this
      - ALLOWED_HOSTS=daytrack.niochat.com.br,localhost,127.0.0.1
      - DATABASE_URL=postgresql://postgres.flojrapvlpueanbpvdab:Semfim01@aws-0-sa-east-1.pooler.supabase.com:6543/postgres
      - CORS_ALLOWED_ORIGINS=https://daytrack.niochat.com.br,http://localhost:3000,http://localhost:5173
    command: >
      sh -c "
      echo '<!DOCTYPE html>
      <html>
      <head>
        <title>DayTrack</title>
        <meta charset=\"utf-8\">
        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">
        <style>
          body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #1a1a1a; color: white; }
          .container { max-width: 800px; margin: 0 auto; text-align: center; }
          h1 { color: #3b82f6; margin-bottom: 20px; }
          .status { background: #22c55e; padding: 10px; border-radius: 5px; margin: 20px 0; }
          .info { background: #374151; padding: 15px; border-radius: 5px; margin: 20px 0; }
        </style>
      </head>
      <body>
        <div class=\"container\">
          <h1>ðŸš€ DayTrack</h1>
          <div class=\"status\">âœ… Sistema funcionando!</div>
          <div class=\"info\">
            <p><strong>Status:</strong> Sistema em desenvolvimento</p>
            <p><strong>DomÃ­nio:</strong> daytrack.niochat.com.br</p>
            <p><strong>VersÃ£o:</strong> Docker + Traefik</p>
          </div>
        </div>
      </body>
      </html>' > /tmp/index.html &&
      python -m http.server 8000 --directory /tmp
      "

networks:
  nioNet:
    external: true
    name: nioNet